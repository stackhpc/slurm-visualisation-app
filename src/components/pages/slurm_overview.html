
<div class="page-header">
    <h1> Slurm Activity Overview </h1>
</div>

<div ng-if="ctrl.pageLoaded == false">
    <!-- loading icon -->
</div>

<div ng-if="ctrl.pageLoaded == true && ctrl.loadFailed == true">

</div>

<div ng-if="ctrl.pageLoaded == true && ctrl.loadFailed == false">

    <div class="cluster-overview-container" style="overflow: hidden">
        <div class="page-header">
            <h4> Cluster Overview </h3>
        </div>
        <div class="panel-container" style="float: left; max-height: 250px; max-width:500px; min-height: 250px; min-width: 500px;">
            <iframe
                src="/dashboard-solo/db/hidden-dashboard?panelId=1&var-datasource=Monasca%20API&var-hostname=gluster-1.alaskalocal"
                height="250px" width="500px" frameborder="0">
            </iframe>
        </div>
    
        <div class="panel-container" style="float: left; max-height: 250px; max-width:500px; min-height: 250px; min-width: 500px;">
            <iframe
                src="/dashboard-solo/db/hidden-dashboard?panelId=1&var-datasource=Monasca%20API&var-hostname=gluster-1.alaskalocal"
                height="250px" width="500px" frameborder="0">
            </iframe>
        </div>
    
        <div class="panel-container" style="float: left; max-height: 250px; max-width:500px; min-height: 250px; min-width: 500px;">
            <iframe
                src="/dashboard-solo/db/hidden-dashboard?panelId=1&var-datasource=Monasca%20API&var-hostname=gluster-1.alaskalocal"
                height="250px" width="500px" frameborder="0">
            </iframe>
        </div>
    </div>

    <div style="width:65%">
        <div class="page-header">
            <h3> Node Overview </h4>
        </div>
        <div class="node-filters"> 
            <div class="gf-form-inline" style="float: left;" >
                <div class="gf-form">
                    <label class="gf-form-label width-8"> Alertness </label>
                </div>
                <div class="gf-form-select-wrapper">
                    <select 
                        class="gf-form-input width-8"
                        ng-options="f for f in ['HIGH', 'MEDIUM', 'LOW']"
                        ng-model="ctrl.node_filters.severity"
                        ng-change="ctrl.filterNodes()">
                    </select>
                </div>
            </div>
            <div class="gf-form-inline" style="float: left;">
                <div class="gf-form">
                    <label class="gf-form-label width-8"> Hostname </label>
                </div>
                <div class="gf-form">
                    <input
                        type="text"
                        class="gf-form-input width-8"
                        ng-model="ctrl.node_filters.hostname"
                        ng-keyup="ctrl.filterNodes()">
                    </input>
                </div>
            </div>
        </div>
        <table class="grafana-options-table">
            <tr>
                <th> Name </th>
                <th> Usage </th>
            </tr>
            <tr ng-repeat="node_and_metrics in ctrl.filtered_nodes_and_metrics"> 
                <td> 
                    <a href="/dashboard/db/system-overview?var-hostname={{node_and_metrics.hostname}}">
                        {{ node_and_metrics.hostname }} 
                    </a>
                </td>
                <td style="color: {{node_and_metrics.metrics.usage.color}}">  {{ node_and_metrics.metrics.usage.percentage }} </td>
            </tr>
        </table>  
    </div>

    <div style="width:65%">
        <div class="page-header"> 
            <h3> Job Overview </h4>
        </div>
        <!-- <div class="gf-form-inline" style="float: left;" >
            <div class="gf-form">
                <label class="gf-form-label width-8"> Alertness </label>
            </div>
            <div class="gf-form">
                <select 
                    class="gf-form-input width-8"
                    ng-options="f for f in ['HIGH', 'MEDIUM', 'LOW']"
                    ng-model="ctrl.node_filters.severity"
                    ng-change="ctrl.filterNodes()">
                </select>
            </div>
        </div> -->
        <div class="job-filters">
            <div class="gf-form-inline filter">
                <div class="gf-form">
                    <label class="gf-form-label width-8"> State </label>
                </div>
                <div class="gf-form-select-wrapper">
                    <select 
                        class="gf-form-input width-8"
                        ng-options="f for f in ['RUNNING', 'PENDING', 'FINISHED']"
                        ng-model="ctrl.job_filters.state"
                        ng-change="ctrl.filterJobs()">
                    </select>
                </div>
            </div>
            <div class="gf-form-inline filter">
                <div class="gf-form">
                    <label class="gf-form-label width-8"> Node </label>
                </div>
                <div class="gf-form">
                    <input
                        type="text"
                        class="gf-form-input width-8",
                        bs-typeahead="ctrl.suggestNodesByHostname",
                        ng-model="ctrl.job_filters.hostname",
                        ng-keyup="ctrl.filterJobs()">
                    </input>
                </div>
            </div>
            <div class="gf-form-inline filter" style="clear: left">
                <div class="gf-form-select-wrapper">
                    <select
                        class="gf-form-input"
                        ng-options="f for f in ['STARTED AFTER', 'STARTED BEFORE']"
                        ng-model="ctrl.job_filters.start_time.filter"
                        ng-change="ctrl.filterJobs()">
                    </select>
                </div>
                 <div class="gf-form">
                    <input
                        type="datetime-local",
                        placeholder="yyyy-MM-ddTHH:mm:ss",
                        class="gf-form-input",
                        ng-model="ctrl.job_filters.start_time.time"
                        ng-change="ctrl.filterJobs()">
                    </input>
                </div>
            </div>
            <div class="gf-form-inline filter">
                    <div class="gf-form-select-wrapper">
                        <select
                            class="gf-form-input"
                            ng-options="f for f in ['ENDED AFTER', 'ENDED BEFORE']"
                            ng-model="ctrl.job_filters.end_time.filter"
                            ng-change="ctrl.filterJobs()">
                        </select>
                    </div>
                     <div class="gf-form">
                        <input
                            type="datetime-local",
                            placeholder="yyyy-MM-ddTHH:mm:ss",
                            class="gf-form-input",
                            ng-model="ctrl.job_filters.end_time.time"
                            ng-change="ctrl.filterJobs()">
                        </input>
                    </div>
                </div>
        </div>
        <table class="grafana-options-table">
            <tr>
                <th> Name </th>
                <th> Resources </th>
                <th> Elapsed Time </th>
                <th> State </th>
            </tr>
            <tr ng-repeat="job_and_metrics in ctrl.filtered_jobs_and_metrics"> 
                <td> {{ job_and_metrics.name }} </td>
                <td> 
                    <div ng-repeat="resource in job_and_metrics.metrics.resources" style="padding: 5px">
                        <span ng-if="ctrl.isArray(resource.value)"> 
                            {{ resource.name }}: [
                            <div ng-click="ctrl.redirecttoJobNodeStatistics(hostname, job_and_metrics)" ng-repeat="hostname in resource.value" style="margin-left: 30px";>
                                {{ hostname }}
                            </div>
                            ]
                        </span>
                        <span ng-if="!ctrl.isArray(resource.value)"> 
                            {{ resource.name }}: {{ resource.value }}
                        </span>
                    </div>
                </td>
                <td> {{ job_and_metrics.metrics.elapsed_time }} </td>
                <td> {{ job_and_metrics.metrics.state }} </td>
            </tr>
        </table>  
    </div>
</div>

